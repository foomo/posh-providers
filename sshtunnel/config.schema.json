{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/your-org/posh-providers/sshTunnel/config",
  "$ref": "#/$defs/Config",
  "$defs": {
    "TargetAuth": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["sshpass", "key"],
          "description": "Authentication type: password or SSH key"
        },
        "password": {
          "type": "string",
          "description": "Password for sshpass (plain or 1Password reference)"
        },
        "privateKey": {
          "type": "string",
          "description": "Path to private key or 1Password reference"
        }
      },
      "additionalProperties": false,
      "required": ["type"],
      "if": {
        "properties": { "type": { "const": "sshpass" } }
      },
      "then": { "required": ["password"] },
      "else": { "required": ["privateKey"] }
    },
    "Tunnel": {
      "type": "object",
      "properties": {
        "name": { "type": "string", "description": "Tunnel name" },
        "sudo": { "type": "boolean", "description": "Run tunnel with sudo", "default": false },
        "localPort": { "type": "integer", "description": "Local port to bind" },
        "targetProxyHost": { "type": "string", "description": "Host of the target proxy" },
        "targetProxyPort": { "type": "integer", "description": "Target proxy port" },
        "targetUsername": { "type": "string", "description": "Username for SSH connection" },
        "targetHost": { "type": "string", "description": "Target SSH host" },
        "targetAuth": { "$ref": "#/$defs/TargetAuth" }
      },
      "required": ["name", "localPort", "targetProxyHost", "targetProxyPort", "targetUsername", "targetHost", "targetAuth"],
      "additionalProperties": false
    },
    "Config": {
      "type": "object",
      "properties": {
        "socketsPath": { "type": "string", "description": "Path for socket files" },
        "tempDir": { "type": "string", "description": "Directory to store temporary keys" },
        "tunnels": {
          "type": "array",
          "items": { "$ref": "#/$defs/Tunnel" },
          "description": "List of SSH tunnels"
        }
      },
      "required": ["socketsPath", "tempDir", "tunnels"],
      "additionalProperties": false
    }
  }
}
